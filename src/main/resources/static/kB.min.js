class APIs{static ping(url,successCb,errorCb,timeout){let headers={Accept:"application/json","Content-Type":"application/json"};fetch(url,{mode:"no-cors",credentials:"include",method:"HEAD",headers:headers,timeout:timeout}).then(()=>{if(successCb!=null)successCb()}).catch(()=>{if(errorCb!=null)errorCb()})}}class BootstrapUtils{static childrenInnerText(el){const ret=[];const children=el.childNodes;let index=0;children.forEach(item=>{ret[index++]=item.firstChild.innerText});return ret}static textMemoryQueue(el,par,key,maxItems){BootstrapUtils.queue(el,par,maxItems);const innerTextAsJson=BootstrapUtils.childrenInnerText(par);Storage.setParse(PREFIX+key,innerTextAsJson)}static queue(el,par,maxItems=12){par.prepend(BootstrapUtils.queueWrapper(el,maxItems));if(par.childElementCount>=maxItems+1)par.removeChild(par.lastChild)}static queueWrapper(el,maxItems=12){const rows=2;const itemsPerRow=maxItems/rows;const wrapper=document.createElement("div");wrapper.classList.add(`col-md-${12/itemsPerRow}`,"col-6","p-1");el.classList.add("w-100","h-100");wrapper.appendChild(el);return wrapper}static button(text,onclick){const btn=document.createElement("button");btn.innerText=text;btn.onclick=onclick;btn.classList.add("btn","btn-primary");return btn}}class ColorUtils{static hexToHSL(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);var r=parseInt(result[1],16);var g=parseInt(result[2],16);var b=parseInt(result[3],16);r/=255,g/=255,b/=255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0}else{var d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}s=s*100;s=Math.round(s);l=l*100;l=Math.round(l);h=Math.round(360*h);return{h:h,s:s,l:l}}static hslObjToString(hslObj){return hslObj.h+", "+hslObj.s+"%, "+hslObj.l+"%"}static hexToHSLString(hex){const hslObj=ColorUtils.hexToHSL(hex);return ColorUtils.hslObjToString(hslObj)}static hslToHex(h,s,l){h/=360;s/=100;l/=100;let r,g,b;if(s===0){r=g=b=l}else{const hue2rgb=(p,q,t)=>{if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p};const q=l<.5?l*(1+s):l+s-l*s;const p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}const toHex=x=>{const hex=Math.round(x*255).toString(16);return hex.length===1?"0"+hex:hex};return`#${toHex(r)}${toHex(g)}${toHex(b)}`}}class Events{static elMousePosEvent(event){return elMousePos(event.target)}static elMousePos(el){const rect=el.getBoundingClientRect();const x=event.clientX-rect.left;const y=event.clientY-rect.top;return{x:x,y:y}}}class HTMLUtils{static fromS(str){var parser=new DOMParser;var doc=parser.parseFromString(str,"text/html");return doc.body.firstChild}static toClipboardForce(value){if(typeof navigator.clipboard=="undefined"){const textArea=document.createElement("textarea");textArea.value=value;textArea.style.position="fixed";document.body.appendChild(textArea);textArea.focus();textArea.select();let ret=false;try{ret=document.execCommand("copy")}catch(err){console.log("Copy failed")}finally{document.body.removeChild(textArea)}return ret}else{navigator.clipboard.writeText(value)}}static pasteForce(cb){if(typeof navigator.clipboard=="undefined"){const pasteTarget=document.createElement("div");pasteTarget.contentEditable=true;const actElem=document.activeElement.appendChild(pasteTarget).parentNode;pasteTarget.focus();document.execCommand("paste",null,null);const paste=pasteTarget.innerText;console.log(pasteTarget);actElem.removeChild(pasteTarget);console.log(paste);cb(paste)}else{navigator.clipboard.readText().then(text=>{cb(text)})}}}class Storage{static get(key){return localStorage.getItem(key)}static getOrI(key,i){const local=Storage.get(key);return local!=null?local:i}static getParse(key){return JSON.parse(Storage.get(key))}static getParseOrI(key,i){const local=Storage.getParse(key);return local!=null?local:i}static set(key,value){localStorage.setItem(key,value)}static setParse(key,value){Storage.set(key,JSON.stringify(value))}}function guiInit(){const key="recent-commands";const arr=Storage.getParse(PREFIX+key);const par=document.getElementById("recentCommands");if(arr!=null){arr.forEach(str=>{const wrapper=BootstrapUtils.queueWrapper(BootstrapUtils.button(str,sendSetInpFillDisplayEvent));par.append(wrapper)})}}function sendSetInpFillDisplayEvent(event){sendSetInpFillDisplay(event.target.innerText)}function sendSetInpFillDisplay(command){setInp(command);kBUtils.send(command,fillDisplay)}function commandBankDropDownClick(item){sendSetInpFillDisplay(item.innerText);const btn=BootstrapUtils.button(item.innerText,sendSetInpFillDisplayEvent);const parent=document.getElementById("recentCommands");BootstrapUtils.textMemoryQueue(btn,parent,"recent-commands")}const PREFIX="kbcookie__";function init(){pingLinks()}function pingLinks(){const kbLinks=document.getElementsByClassName("kb-links");for(var i=0;i<kbLinks.length;i++){const link=kbLinks.item(i);const linkA=link.children[0];const linkHREF=linkA.href;linkA.className="nav-link text-warning";APIs.ping(linkHREF,resp=>{linkA.className="nav-link text-success"},err=>{linkA.className="nav-link text-danger"},1e4)}}function kbInp(){return document.getElementById("kbInp")}function setInp(str){kbInp().value=str}function clearInp(){kbInp().value=""}function textDisplay(){return document.getElementById("textDisplay")}function imagesDisplay(){return document.getElementById("imagesDisplay")}function sendInp(){kBUtils.send(kbInp().value,fillDisplay)}function fillDisplay(json){const images=json.images;if(images!=null&&images.length>0){const imgSrc="data:image/png;base64, "+images[0];const thumbnail=`<img src='${imgSrc}' alt=""
                            style="width: 7rem;max-width: 100%;height: auto;vertical-align: 
                            middle;border-style: none;">`;const thumbnailEl=HTMLUtils.fromS(thumbnail);BootstrapUtils.queue(thumbnailEl,imagesDisplay(),8)}const tDisp=textDisplay();tDisp.innerHTML="";json.resp.forEach(item=>{const pEl=document.createElement(item?"pre":"br");pEl.innerHTML=item;tDisp.append(pEl)})}class kBUtils{static send(commandString,receiverFunc){fetch("/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:commandString}).then(resp=>resp.json()).then(json=>{receiverFunc(json)})}}function colorsMenu(){return document.getElementById("colorsMenu")}function colorsInp(){return document.getElementById("colorsInp")}function colorsKey(){return PREFIX+"colors-data"}function colorsData(){return Storage.getParse(colorsKey())}function settingsInit(){setRootColors(colorsData())}function settingsGUIInit(){let cData=colorsData();if(cData==null){cData=newColorsDataObj();Storage.setParse(colorsKey(),cData)}const cMenu=colorsMenu();cMenu.innerHTML="";for(const key in cData){const option=document.createElement("option");option.value=cData[key];option.innerText=key;cMenu.append(option)}colorsSelect(cMenu)}function newColorsDataObj(){return{primary:"208, 100.0%, 49.0%",secondary:"210, 7.0%, 56.0%",success:"120, 39.0%, 54.0%",info:"194, 66.0%, 61.0%",warning:"35, 84.0%, 62.0%",danger:"2, 64.0%, 58.0%",inverse:"200, 4.0%, 17.0%",faded:"0, 0.01%, 97.0%",bg:"243, 100.0%, 13.1%"}}function colorsSelect(cMenu){const oValue=cMenu.value;const oValueSplit=oValue.split(", ");const h=parseFloat(oValueSplit[0]);const s=parseFloat(oValueSplit[1].replace("%",""));const l=parseFloat(oValueSplit[2].replace("%",""));colorsInp().value=ColorUtils.hslToHex(h,s,l)}function colorsChange(colorsInp){const cMenu=colorsMenu();const option=cMenu.options[cMenu.selectedIndex];const hslString=ColorUtils.hexToHSLString(colorsInp.value);option.value=hslString;setRootColor(option.text,hslString)}function colorsSave(){Storage.setParse(colorsKey(),getColorsFromSelect())}function colorsDefault(){setColorsData(newColorsDataObj())}function copyColors(){const cData=getColorsFromSelect();const cDataJson=JSON.stringify(cData,null," ");HTMLUtils.toClipboardForce(cDataJson)}function pasteColors(){HTMLUtils.pasteForce(text=>{try{setColorsData(JSON.parse(text))}catch(e){return false}})}function setColorsData(obj){Storage.setParse(colorsKey(),obj);settingsInit();settingsGUIInit()}function setRootColor(key,hslString){const hslSplit=hslString.split(", ");const docElStyle=document.documentElement.style;const valuePrefix="--"+key+"-";docElStyle.setProperty(valuePrefix+"raw",hslSplit[0]+", "+hslSplit[1]);docElStyle.setProperty(valuePrefix+"l",hslSplit[2])}function setRootColors(cData){if(cData!=null){for(const key in cData){const value=cData[key];setRootColor(key,value)}}}function getColorsFromSelect(){const cMenu=colorsMenu();const cData={};const options=cMenu.options;const optionsLength=options.length;for(let i=0;i<optionsLength;i++){const option=options[i];cData[option.text]=option.value}return cData}